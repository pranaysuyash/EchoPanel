# STO-012 Session Deletion

## Summary
- Origin: Code-only
- Status: Implemented
- Removes session directory and all associated files from filesystem, clearing recovery markers if applicable.
- Boundaries crossed: Storage, UI
- Primary components (coarse list): SessionStore, SessionHistoryView

## Triggers and Preconditions
- Triggers (user action, event, schedule, startup, etc.): User clicks delete button in SessionHistoryView after confirmation
- Preconditions (permissions, settings flags, availability, model cached, etc.): Session directory exists in Application Support/sessions/

## Sequence (Happy Path)
Use numbered sequence. Each step must include evidence.
For each step:
1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. deleteSession() constructs session directory path from sessionId
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SessionStore.swift :: let sessionDir = sessionsDir.appendingPathComponent(sessionId)

2. Removes session directory recursively using FileManager.removeItem()
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SessionStore.swift :: try fileManager.removeItem(at: sessionDir)

3. If deleted session was the recoverable session, clears recovery markers
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SessionStore.swift :: if recoverableSessionId == sessionId { clearRecoveryMarker() }

4. Posts sessionHistoryShouldRefresh notification to update UI
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SessionStore.swift :: NotificationCenter.default.post(name: .sessionHistoryShouldRefresh, object: nil)

## Inputs and Outputs
- Inputs: sessionId string
- Outputs: None
- Side effects (writes, network calls, model loads, UI state changes): File system directory deletion, @Published property updates, UI refresh notification

## Failure Modes
List 5â€“10 realistic failures:
- Failure: Sessions directory not accessible
  - Where detected: deleteSession()
  - Current handling (as evidenced): guard let sessionsDir returns early
  - User-visible outcome (if any): Silent failure, session not deleted
  - Evidence: macapp/MeetingListenerApp/Sources/SessionStore.swift :: guard let sessionsDir = sessionsDirectory else { return }

- Failure: Session directory does not exist
  - Where detected: deleteSession()
  - Current handling (as evidenced): if fileManager.fileExists() check prevents error
  - User-visible outcome (if any): Silent success (no-op)
  - Evidence: macapp/MeetingListenerApp/Sources/SessionStore.swift :: if fileManager.fileExists(atPath: sessionDir.path)

- Failure: FileManager.removeItem() fails (permissions, in use, etc.)
  - Where detected: deleteSession()
  - Current handling (as evidenced): do/catch logs error, continues
  - User-visible outcome (if any): Session not deleted, error logged
  - Evidence: macapp/MeetingListenerApp/Sources/SessionStore.swift :: do { ... } catch { NSLog("SessionStore: Failed to delete session %@: %@", sessionId, error.localizedDescription) }

- Failure: Recovery marker clearing fails
  - Where detected: deleteSession()
  - Current handling (as evidenced): No error handling for clearRecoveryMarker()
  - User-visible outcome (if any): Recovery state may be stale
  - Evidence: macapp/MeetingListenerApp/Sources/SessionStore.swift :: clearRecoveryMarker() (no try/catch)

- Failure: Notification posting fails
  - Where detected: deleteSession()
  - Current handling (as evidenced): No error handling
  - User-visible outcome (if any): UI doesn't refresh automatically
  - Evidence: macapp/MeetingListenerApp/Sources/SessionStore.swift :: NotificationCenter.default.post (no error checking)

## Data and Storage
- What data is produced/consumed: Session directory contents (snapshot.json, transcript.jsonl, metadata.json, etc.)
- Where it is stored (DB/files/userData/etc.): ~/Library/Application Support/com.echopanel/sessions/<session_id>/
- Retention / deletion controls (if documented): Manual deletion only, no automatic cleanup

## Observability
- Logs/events emitted: Error log on deletion failure with sessionId
- Correlation IDs / session IDs (if any): sessionId in error logs
- Metrics/traces (if any): None evidenced
Evidence required: macapp/MeetingListenerApp/Sources/SessionStore.swift :: NSLog("SessionStore: Failed to delete session %@: %@", sessionId, error.localizedDescription)

## Open Questions and Follow-up Tasks
- Questions that cannot be answered from current evidence: What happens if session is currently being written to?
- Documentation gaps to fill: Recovery marker clearing logic
- Test gaps to add (note only, no implementation): Deletion of recoverable sessions, concurrent access during deletion</content>
<parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/STO-012.md
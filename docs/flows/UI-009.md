# UI-009 Pin Toggle on Focused Segment

## Summary

- Origin: Code-only
- Status: Implemented
- Pinning lets users mark important transcript lines and revisit them from the Pins surface.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelStateLogic, SidePanelTranscriptSurfaces

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): `P` key or pin button on focused row
- Preconditions (permissions, settings flags, availability, model cached, etc.): transcript contains target segment

## Sequence (Happy Path)

1. User pins/unpins current line (`P`) or row action button.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `handleKeyEvent` chars `"p"` -> `togglePin(id)`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `onPin` callback -> `togglePin(segment.id)`
2. `togglePin` inserts/removes id from `pinnedSegmentIDs` set.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `togglePin(_:)`
3. Pins surface reads resolved pinned segments and allows jump-to-segment behavior.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `pinnedSegments`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `surfaceContent(.pins)`
4. Transcript sanitization removes pin ids for segments no longer present.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `sanitizeStateForTranscript()`

## Inputs and Outputs

- Inputs: pin/unpin intent + segment id
- Outputs: pin state and pins-surface content
- Side effects (writes, network calls, model loads, UI state changes): focus + overlay navigation updates when opening a pinned item

## Failure Modes

- Failure: Pin requested with no focused segment
  - Where detected: key handler optional guard
  - Current handling (as evidenced): no-op
  - User-visible outcome (if any): no pin state change
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `if let id = focusedSegmentID`

- Failure: Transcript churn invalidates pinned id
  - Where detected: pin sanitization
  - Current handling (as evidenced): invalid ids dropped automatically
  - User-visible outcome (if any): pin disappears when source segment no longer exists
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `intersection(sourceIDs)`

## Data and Storage

- What data is produced/consumed: set of pinned transcript UUIDs
- Where it is stored (DB/files/userData/etc.): in-memory `@State` within side panel
- Retention / deletion controls (if documented): session/view lifecycle scoped

## Observability

- Logs/events emitted: none
- Correlation IDs / session IDs (if any): none
- Metrics/traces (if any): none

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: none
- Documentation gaps to fill: none
- Test gaps to add (note only, no implementation): pin persistence expectations across panel reopen/session boundaries

# UI-009 Pin Toggle on Focused Segment

## Summary

- Origin: Code-only
- Status: Hypothesized
- User toggles pin status on the currently focused transcript segment using P key.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelView, SidePanelStateLogic

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): User presses P key while side panel is focused
- Preconditions (permissions, settings flags, availability, model cached, etc.): Side panel is open, a segment is focused (focusedSegmentID != nil)

## Sequence (Happy Path)

Use numbered sequence. Each step must include evidence.
For each step:

1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. User presses P key
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: handleKeyEvent (charsIgnoring == "p")
   - Notes: Case-insensitive character check

1. togglePin called with focusedSegmentID
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: togglePin(\_ id: UUID)
   - Notes: Only if focusedSegmentID exists

1. togglePin finds the segment and toggles its pinned status
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: togglePin
   - Notes: Updates appState.pinnedSegmentIDs set

1. UI updates pin indicator on the segment
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: pinnedSegmentIDs @Published
   - Notes: Hypothesized - SwiftUI reactive update

## Inputs and Outputs

- Inputs: P key press
- Outputs: Pin indicator appears/disappears on focused segment
- Side effects (writes, network calls, model loads, UI state changes): Updates appState.pinnedSegmentIDs

## Failure Modes

List 5â€“10 realistic failures:

- Failure: No focused segment
  - Where detected: handleKeyEvent
  - Current handling (as evidenced): Guard let id = focusedSegmentID
  - User-visible outcome (if any): No action
  - Evidence: Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: if let id = focusedSegmentID

- Failure: Segment not found in transcript
  - Where detected: togglePin
  - Current handling (as evidenced): Find segment by id
  - User-visible outcome (if any): No pin change
  - Evidence: Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: guard let segment = appState.transcriptSegments.first

- Failure: Pin indicator fails to update
  - Where detected: SwiftUI rendering
  - Current handling (as evidenced): None evidenced
  - User-visible outcome (if any): Visual pin not shown/hidden
  - Evidence: Hypothesized

## Data and Storage

- What data is produced/consumed: pinnedSegmentIDs Set<UUID>
- Where it is stored (DB/files/userData/etc.): In-memory @Published in AppState
- Retention / deletion controls (if documented): Persisted? None evidenced

## Observability

- Logs/events emitted: None evidenced
- Correlation IDs / session IDs (if any): None
- Metrics/traces (if any): None evidenced

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: How are pins visually indicated? Are they persisted?
- Documentation gaps to fill: Pin UI implementation and persistence
- Test gaps to add (note only, no implementation): Test pin toggle adds/removes from set</content>
  <parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/UI-009.md

# UI-008 Lens Toggle on Focused Segment

## Summary

- Origin: Code-only
- Status: Implemented
- Enter/double-click toggles a focus lens for the selected transcript segment.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelStateLogic, SidePanelTranscriptSurfaces, SidePanelChromeViews

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): Enter key on focused line or double-click transcript row
- Preconditions (permissions, settings flags, availability, model cached, etc.): focused segment exists for keyboard path

## Sequence (Happy Path)

1. User toggles lens via Enter key or row double-click.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `handleKeyEvent` case `36` -> `toggleLens(id)`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `.onTapGesture(count: 2)` -> `toggleLens(segment.id)`
2. `toggleLens` sets/clears `lensSegmentID` and disables follow-live.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `toggleLens(_:)`
3. Lens card is rendered under active transcript row when ids match.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `if lensSegmentID == segment.id { focusLens(...) }`
4. Lens card provides quick surface switching actions.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelChromeViews.swift` :: `focusLens(segment:)`

## Inputs and Outputs

- Inputs: focused segment id + lens toggle intent
- Outputs: lens open/close state and optional surface changes
- Side effects (writes, network calls, model loads, UI state changes): `followLive` may be disabled for stable inspection

## Failure Modes

- Failure: Enter pressed without focused segment
  - Where detected: optional id guard in key handler
  - Current handling (as evidenced): no-op
  - User-visible outcome (if any): no lens change
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `if let id = focusedSegmentID { toggleLens(id) }`

- Failure: Lens target removed from transcript
  - Where detected: transcript state sanitization
  - Current handling (as evidenced): stale `lensSegmentID` cleared
  - User-visible outcome (if any): lens closes automatically
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `sanitizeStateForTranscript()`

## Data and Storage

- What data is produced/consumed: `lensSegmentID`
- Where it is stored (DB/files/userData/etc.): in-memory view state
- Retention / deletion controls (if documented): cleared when invalidated or jump-to-live path resets

## Observability

- Logs/events emitted: none
- Correlation IDs / session IDs (if any): none
- Metrics/traces (if any): none

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: none
- Documentation gaps to fill: none
- Test gaps to add (note only, no implementation): Enter + double-click parity tests

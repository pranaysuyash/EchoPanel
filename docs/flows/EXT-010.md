# EXT-010 Session History Browse

## Summary

- Origin: Code-only
- Status: Implemented
- Provides split-pane UI for browsing past sessions with search, viewing transcript/summary/JSON, and export/delete actions. Sessions stored as directories with metadata and transcript files.
- Boundaries crossed: UI (history window) / Storage (filesystem session directories)
- Primary components (coarse list): SessionHistoryView, SessionStore

## Triggers and Preconditions

- Triggers: User opens session history window from menu/hotkey
- Preconditions: Sessions exist in storage, app running

## Sequence (Happy Path)

Use numbered sequence. Each step must include evidence.
For each step:

1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. User opens session history window
   - Evidence:
     - Code: MeetingListenerApp.swift :: SessionHistoryView(appState: appState, sessionStore: sessionStore)
     - Docs: flow-atlas-20260211.md :: EXT-010 Session History Browse

1. View loads session list from SessionStore.listSessions()
   - Evidence:
     - Code: SessionHistoryView :: .onAppear { reload() }
     - Code: SessionHistoryView :: sessions = sessionStore.listSessions()

1. SessionStore scans sessions directory for session folders
   - Evidence:
     - Code: SessionStore :: listSessions() :: let contents = try fileManager.contentsOfDirectory(at: sessionsDir, ...)
     - Code: SessionStore :: listSessions() :: guard url.hasDirectoryPath

1. For each session directory, extracts metadata and checks for transcript
   - Evidence:
     - Code: SessionStore :: listSessions() :: let metadataURL = url.appendingPathComponent("metadata.json")
     - Code: SessionStore :: listSessions() :: let hasTranscript = fileManager.fileExists(atPath: transcriptURL.path)

1. User selects session from sorted list (newest first)
   - Evidence:
     - Code: SessionHistoryView :: List(selection: $selectedSessionId)
     - Code: SessionHistoryView :: return sessions.sorted { $0.date > $1.date }

1. View loads selected session snapshot via SessionStore.loadSnapshot()
   - Evidence:
     - Code: SessionHistoryView :: loadSnapshot(for: newValue)
     - Code: SessionHistoryView :: selectedSnapshot = sessionStore.loadSnapshot(sessionId: sessionId)

1. User can switch between Summary/Transcript/JSON tabs
   - Evidence:
     - Code: SessionHistoryView :: Picker("View", selection: $selectedTab)
     - Code: SessionHistoryView :: switch selectedTab { case .summary: ... case .transcript: ... case .json: ... }

1. User can export selected session as Markdown or JSON
   - Evidence:
     - Code: SessionHistoryView :: exportSelectedMarkdown(); exportSelectedSnapshot()
     - Code: SessionHistoryView :: Button { exportSelectedMarkdown() } label: { Label("Export Markdown…") }

## Inputs and Outputs

- Inputs: User selection of session and view tab
- Outputs: Display of session data in selected format
- Side effects (writes, network calls, model loads, UI state changes): None, read-only browsing

## Failure Modes

List 5–10 realistic failures:

- Failure: Sessions directory not accessible
  - Where detected: fileManager.contentsOfDirectory throws
  - Current handling (as evidenced): Returns empty list, logs error
  - User-visible outcome (if any): Empty session list
  - Evidence: SessionStore :: catch { NSLog("SessionStore: Failed to list sessions: \(error)") }

- Failure: Session metadata file corrupted
  - Where detected: JSONSerialization.jsonObject fails
  - Current handling (as evidenced): Uses current date as fallback
  - User-visible outcome (if any): Session shows current date
  - Evidence: SessionStore :: let metadata = try? JSONSerialization.jsonObject(with: metadataData) as? [String: Any]

- Failure: Session snapshot load fails
  - Where detected: sessionStore.loadSnapshot returns nil
  - Current handling (as evidenced): selectedSnapshot remains nil
  - User-visible outcome (if any): Detail pane shows "Select a session" message
  - Evidence: SessionHistoryView :: selectedSnapshot = sessionStore.loadSnapshot(sessionId: sessionId)

## Data and Storage

- What data is produced/consumed: Session metadata, transcripts, final summaries
- Where it is stored (DB/files/userData/etc.): Filesystem directories per session (metadata.json, transcript.jsonl, etc.)
- Retention / deletion controls (if documented): Manual delete from UI, no automatic cleanup

## Observability

- Logs/events emitted: Error logs for directory access failures
- Correlation IDs / session IDs (if any): session_id in file paths and data
- Metrics/traces (if any): None
  Evidence: SessionStore :: NSLog("SessionStore: Failed to list sessions: \(error)")

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: What triggers session refresh? How are recoverable sessions handled?
- Documentation gaps to fill: Session storage format specification
- Test gaps to add (note only, no implementation): Test corrupted session data, test large session lists</content>
  <parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/EXT-010.md

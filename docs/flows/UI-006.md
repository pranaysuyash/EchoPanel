# UI-006 Side Panel Surface Cycling

## Summary

- Origin: Code-only
- Status: Implemented
- Left/right controls cycle insight surfaces in roll/compact and insight tabs in full mode.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelView, SidePanelStateLogic, SidePanelTranscriptSurfaces

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): arrow keys, surface menu/button taps
- Preconditions (permissions, settings flags, availability, model cached, etc.): side panel focused

## Sequence (Happy Path)

1. Left/right keyboard events are captured.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `handleKeyEvent` keycodes `123/124`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanelView.swift` :: `.onMoveCommand` left/right
2. `handleHorizontalSurface(delta:)` dispatches by mode/overlay state.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `handleHorizontalSurface`
3. In roll/compact, first left/right opens overlay at `summary`; subsequent presses call `cycleSurface`.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `showSurfaceOverlay = true`, `activeSurface = .summary`, `cycleSurface`
4. In full mode, left/right cycles `fullInsightTab`.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `cycleFullInsightTab`
5. UI controls also set/toggle surfaces.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Roll/SidePanelRollViews.swift` :: `Button("Surfaces")`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Compact/SidePanelCompactViews.swift` :: `Button("Surfaces")`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `Menu("Surface")`

## Inputs and Outputs

- Inputs: left/right commands, surface button/menu actions
- Outputs: active surface/tab transitions and overlay visibility changes
- Side effects (writes, network calls, model loads, UI state changes): updates to `activeSurface`, `fullInsightTab`, `showSurfaceOverlay`

## Failure Modes

- Failure: Invalid index math while cycling
  - Where detected: cycling helpers
  - Current handling (as evidenced): modular arithmetic wraps cleanly
  - User-visible outcome (if any): cyclic behavior, no out-of-range crash
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: modulo index calculations

- Failure: Overlay left open unintentionally
  - Where detected: escape/close flow
  - Current handling (as evidenced): `Esc`/close button closes top layer
  - User-visible outcome (if any): recoverable via keyboard or close button
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `closeTopLayer`; `SidePanelTranscriptSurfaces.swift` close button

## Data and Storage

- What data is produced/consumed: `activeSurface`, `fullInsightTab`, `showSurfaceOverlay`
- Where it is stored (DB/files/userData/etc.): in-memory view state
- Retention / deletion controls (if documented): reset on view lifecycle

## Observability

- Logs/events emitted: none
- Correlation IDs / session IDs (if any): none
- Metrics/traces (if any): none

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: none
- Documentation gaps to fill: none
- Test gaps to add (note only, no implementation): keyboard left/right integration coverage per view mode

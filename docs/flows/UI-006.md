# UI-006 Side Panel Surface Cycling

## Summary

- Origin: Code-only
- Status: Hypothesized
- User cycles through insight surfaces (Summary, Actions, Pins, Entities, Raw) in the side panel overlay using left/right arrow keys.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelView, SidePanelStateLogic

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): User presses left or right arrow key while side panel is focused
- Preconditions (permissions, settings flags, availability, model cached, etc.): Side panel is open, not in Full mode (or in Full mode but surface overlay is shown)

## Sequence (Happy Path)

Use numbered sequence. Each step must include evidence.
For each step:

1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. User presses left or right arrow key
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: handleKeyEvent (case 124: right, case 123: left)
   - Notes: Key codes 124 for right, 123 for left

1. handleHorizontalSurface called with delta (+1 for right, -1 for left)
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: handleHorizontalSurface(delta: Int)
   - Notes: Called from onMoveCommand in SidePanelView

1. If in Full mode, cycleFullInsightTab; else if surface overlay shown, cycleSurface; else show surface overlay with summary
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: handleHorizontalSurface
   - Notes: Logic branches based on viewMode and showSurfaceOverlay

1. cycleSurface updates activeSurface to next/previous in enum
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: cycleSurface(\_ delta: Int)
     - Code: macapp/MeetingListenerApp/Sources/SidePanelView.swift :: enum Surface { summary, actions, pins, entities, raw }
   - Notes: Cycles through Surface.allCases

1. UI updates to show the new active surface content
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: activeSurface @Published
   - Notes: Hypothesized - SwiftUI reactive update

## Inputs and Outputs

- Inputs: Left/right arrow key press
- Outputs: Surface overlay displays different content (Summary/Actions/Pins/Entities/Raw)
- Side effects (writes, network calls, model loads, UI state changes): UI state change for activeSurface, possible surface overlay shown if not already

## Failure Modes

List 5â€“10 realistic failures:

- Failure: Key press not handled
  - Where detected: handleKeyEvent
  - Current handling (as evidenced): Return false, event not consumed
  - User-visible outcome (if any): No UI change
  - Evidence: Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: handleKeyEvent return false

- Failure: Surface enum index out of bounds
  - Where detected: cycleSurface
  - Current handling (as evidenced): Modular arithmetic with count
  - User-visible outcome (if any): Wraps around to first/last
  - Evidence: Code: macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift :: (idx + delta + Surface.allCases.count) % Surface.allCases.count

- Failure: Surface overlay fails to show
  - Where detected: SwiftUI rendering
  - Current handling (as evidenced): None evidenced
  - User-visible outcome (if any): Overlay not visible
  - Evidence: Hypothesized

## Data and Storage

- What data is produced/consumed: activeSurface enum value
- Where it is stored (DB/files/userData/etc.): In-memory @State/@Published in SidePanelView
- Retention / deletion controls (if documented): None, resets on view recreation

## Observability

- Logs/events emitted: None evidenced
- Correlation IDs / session IDs (if any): None
- Metrics/traces (if any): None evidenced

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: How does the surface overlay UI actually render the different surfaces?
- Documentation gaps to fill: UI rendering logic for surface overlay
- Test gaps to add (note only, no implementation): Test keyboard navigation cycles through all surfaces</content>
  <parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/UI-006.md

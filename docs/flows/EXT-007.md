# EXT-007 Export Markdown

## Summary

- Origin: Code-only
- Status: Implemented
- Exports session notes as formatted Markdown file using macOS save panel. Uses final summary if available, otherwise renders live transcript with entities/actions/decisions/risks.
- Boundaries crossed: UI (save panel) / Storage (file write)
- Primary components (coarse list): AppState, NSSavePanel

## Triggers and Preconditions

- Triggers: User clicks "Export Markdown" button in UI
- Preconditions: Session data available (transcript or final summary)

## Sequence (Happy Path)

Use numbered sequence. Each step must include evidence.
For each step:

1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. User clicks Export Markdown button in side panel or summary view
   - Evidence:
     - Code: SidePanelTranscriptSurfaces.swift :: Button("Export Markdown") { appState.exportMarkdown() }
     - Docs: flow-atlas-20260211.md :: EXT-007 Export Markdown

1. App displays macOS save panel with text file type and default name
   - Evidence:
     - Code: AppState.swift :: exportMarkdown() :: let panel = NSSavePanel(); panel.allowedContentTypes = [UTType.plainText]
     - Code: AppState.swift :: exportMarkdown() :: panel.nameFieldStringValue = "echopanel-notes.md"

1. User selects save location and confirms
   - Evidence:
     - Code: AppState.swift :: exportMarkdown() :: panel.begin { response in guard response == .OK, let url = panel.url

1. App generates markdown content from final summary or live render
   - Evidence:
     - Code: AppState.swift :: exportMarkdown() :: let markdown = self.finalSummaryMarkdown.isEmpty ? self.renderLiveMarkdown() : self.finalSummaryMarkdown
     - Code: AppState.swift :: renderLiveMarkdown() :: generates formatted markdown from current state

1. App writes markdown string to file with UTF-8 encoding
   - Evidence:
     - Code: AppState.swift :: exportMarkdown() :: try markdown.write(to: url, atomically: true, encoding: .utf8)

## Inputs and Outputs

- Inputs: User save location selection
- Outputs: Markdown file written to user-selected path
- Side effects (writes, network calls, model loads, UI state changes): File written to filesystem, save panel displayed

## Failure Modes

List 5â€“10 realistic failures:

- Failure: User cancels save panel
  - Where detected: panel.begin response != .OK
  - Current handling (as evidenced): Cancellation is recorded via `recordExportCancelled(format:)`
  - User-visible outcome (if any): In-app notice shown ("Markdown export cancelled")
  - Evidence: AppState.swift :: exportMarkdown(), recordExportCancelled(format:)

- Failure: File write fails (permissions, disk full, etc.)
  - Where detected: markdown.write throws
  - Current handling (as evidenced): Exception caught, logged, and routed to `recordExportFailure(format:error:)`
  - User-visible outcome (if any): In-app error notice shown with failure reason
  - Evidence: AppState.swift :: exportMarkdown(), recordExportFailure(format:error:)

## Data and Storage

- What data is produced/consumed: Formatted markdown with transcript, entities, actions/decisions/risks
- Where it is stored (DB/files/userData/etc.): User-selected file path as .md
- Retention / deletion controls (if documented): User-managed file

## Observability

- Logs/events emitted: Structured error log on failure, plus user-facing notice updates (success/cancel/failure)
- Correlation IDs / session IDs (if any): None in logs, but session data may include IDs
- Metrics/traces (if any): None
  Evidence: AppState.swift :: recordExportSuccess/recordExportCancelled/recordExportFailure

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: Difference between final summary and live render?
- Documentation gaps to fill: Markdown format specification
- Test gaps to add (note only, no implementation): Test export with/without final summary, test file write failures</content>
  <parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/EXT-007.md

# UI-007 Transcript Focus Navigation

## Summary

- Origin: Code-only
- Status: Implemented
- Up/down navigation moves focused transcript line and syncs scroll/timeline state.
- Boundaries crossed: UI
- Primary components (coarse list): SidePanelView, SidePanelStateLogic, SidePanelTranscriptSurfaces

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): up/down keys via keyboard monitor or move-command handler
- Preconditions (permissions, settings flags, availability, model cached, etc.): side panel focused; at least one visible transcript segment

## Sequence (Happy Path)

1. Up/down key events are captured.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `handleKeyEvent` keycodes `126/125`
     - Code: `macapp/MeetingListenerApp/Sources/SidePanelView.swift` :: `.onMoveCommand` up/down
2. `moveFocus(by:)` calculates next index (clamped).
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `moveFocus(by:)`
3. Focus change disables follow-live and sets pending scroll target.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `followLive = false`, `pendingScrollTarget = focusedSegmentID`
4. Scroll view reader centers focused segment.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelTranscriptSurfaces.swift` :: `.onChange(of: pendingScrollTarget)` -> `proxy.scrollTo(..., anchor: .center)`
5. Timeline readout syncs to new focus.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `.onChange(of: focusedSegmentID)` -> `syncTimelineToFocus()`

## Inputs and Outputs

- Inputs: up/down navigation intent
- Outputs: focused line change + centered scroll target
- Side effects (writes, network calls, model loads, UI state changes): follow-live is turned off on manual navigation

## Failure Modes

- Failure: No visible transcript segments
  - Where detected: guard in `moveFocus`
  - Current handling (as evidenced): no-op
  - User-visible outcome (if any): no focus movement
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `guard !visibleTranscriptSegments.isEmpty else { return }`

- Failure: Surface overlay open in non-full mode
  - Where detected: early return in `moveFocus`
  - Current handling (as evidenced): focus movement intentionally suppressed while overlay active
  - User-visible outcome (if any): arrows operate overlay context
  - Evidence: `macapp/MeetingListenerApp/Sources/SidePanel/Shared/SidePanelStateLogic.swift` :: `if showSurfaceOverlay && viewMode != .full { return }`

## Data and Storage

- What data is produced/consumed: `focusedSegmentID`, `pendingScrollTarget`, `timelinePosition`
- Where it is stored (DB/files/userData/etc.): in-memory view state
- Retention / deletion controls (if documented): sanitized against transcript changes

## Observability

- Logs/events emitted: none
- Correlation IDs / session IDs (if any): none
- Metrics/traces (if any): none

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: none
- Documentation gaps to fill: none
- Test gaps to add (note only, no implementation): focus navigation coverage with overlay-open guard

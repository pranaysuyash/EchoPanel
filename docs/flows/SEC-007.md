# SEC-007 Network Security (TLS)

## Summary

- Origin: Mixed
- Status: Implemented
- Automatic TLS enforcement for remote backend connections while allowing unencrypted localhost connections for development, ensuring secure network transport when communicating with remote servers.
- Boundaries crossed: Network
- Primary components (coarse list): Swift URLSession, backend server (external TLS termination)

## Triggers and Preconditions

- Triggers: Backend connection establishment (WebSocket or HTTP API calls)
- Preconditions: Backend host configured (not localhost), valid TLS certificate on remote server

## Sequence (Happy Path)

1. Client determines backend host from configuration
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/BackendConfig.swift :: isLocalHost
     - Docs: docs/SECURITY.md :: Production must use wss:// with valid TLS
2. Client selects protocol scheme based on host type
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/BackendConfig.swift :: webSocketScheme, httpScheme (ws for localhost, wss/https for remote)
3. For remote hosts, client establishes TLS connection
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/BackendConfig.swift :: URLComponents scheme assignment
     - Docs: docs/SECURITY.md :: Audio streamed over WebSocket. Production must use wss://
4. URLSession performs automatic TLS handshake and certificate validation
   - Evidence:
     - Code: Implicit in URLSession (no explicit TLS code in app)
     - Docs: docs/flows/NET-009.md :: TLS handshake occurs for WSS connections
5. Connection succeeds with encrypted transport
   - Evidence:
     - Code: Successful WebSocket/HTTP connection establishment

## Inputs and Outputs

- Inputs: Backend host configuration
- Outputs: Encrypted network connection (for remote) or unencrypted (for localhost)
- Side effects (writes, network calls, model loads, UI state changes): TLS handshake network traffic

## Failure Modes

- Failure: Remote backend configured but serves WS instead of WSS
  - Where detected: URLSession connection attempt fails
  - Current handling (as evidenced): Connection fails with TLS requirement error
  - User-visible outcome (if any): Backend connection error, session cannot start
  - Evidence: docs/flows/NET-009.md :: TLS required but backend serves WS only
- Failure: Invalid or expired TLS certificate on remote backend
  - Where detected: URLSession TLS validation fails
  - Current handling (as evidenced): Connection rejected by default certificate validation
  - User-visible outcome (if any): Connection fails with certificate error
  - Evidence: docs/flows/NET-009.md :: Invalid TLS certificate on remote backend
- Failure: TLS handshake fails due to network issues
  - Where detected: URLSession during connection establishment
  - Current handling (as evidenced): Connection attempt fails
  - User-visible outcome (if any): Backend unavailable error
  - Evidence: docs/flows/NET-009.md :: TLS handshake occurs for WSS connections

## Data and Storage

- What data is produced/consumed: None (TLS is transport layer encryption)
- Where it is stored (DB/files/userData/etc.): None
- Retention / deletion controls (if documented): None

## Observability

- Logs/events emitted: URLSession connection errors logged by system
- Correlation IDs / session IDs (if any): None
- Metrics/traces (if any): None
  Evidence: No explicit logging in client code for TLS events

## Open Questions and Follow-up Tasks

- Questions: What TLS versions and cipher suites are supported by URLSession?
- Documentation gaps: Server-side TLS configuration requirements for production deployment
- Test gaps: Integration tests for TLS certificate validation behavior
- Follow-up: Consider certificate pinning for additional security if required

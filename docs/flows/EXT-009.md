# EXT-009 Settings Configuration

## Summary

- Origin: Code-only
- Status: Implemented
- Provides tabbed settings UI for configuring audio source, ASR model, backend connection, and broadcast features. Settings persist via @AppStorage and Keychain. Includes model recommendations and server restart capability.
- Boundaries crossed: UI (settings window) / Storage (UserDefaults, Keychain)
- Primary components (coarse list): SettingsView, AppState, BackendManager, KeychainHelper

## Triggers and Preconditions

- Triggers: User opens settings window from menu bar or UI
- Preconditions: App running, settings UI accessible

## Sequence (Happy Path)

Use numbered sequence. Each step must include evidence.
For each step:

1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. User opens settings window via menu bar or UI action
   - Evidence:
     - Code: MeetingListenerApp.swift :: SettingsView(appState: appState, backendManager: backendManager)
     - Docs: flow-atlas-20260211.md :: EXT-009 Settings Configuration

1. Settings view loads persisted values from @AppStorage and Keychain
   - Evidence:
     - Code: SettingsView :: @AppStorage("whisperModel") private var whisperModel = "base.en"
     - Code: SettingsView :: backendToken = KeychainHelper.loadBackendToken() ?? ""

1. User modifies settings in tabbed interface (General, Broadcast)
   - Evidence:
     - Code: SettingsView :: TabView(selection: $selectedTab) { generalSettingsTab; broadcastSettingsTab }
     - Code: SettingsView :: Picker("Source", selection: $appState.audioSource)

1. Changes to @AppStorage properties persist automatically
   - Evidence:
     - Code: SettingsView :: @AppStorage("whisperModel") private var whisperModel = "base.en"
     - Code: SettingsView :: @AppStorage("backendHost") private var backendHost = "127.0.0.1"

1. Backend token changes trigger Keychain save
   - Evidence:
     - Code: SettingsView :: .onChange(of: backendToken) { token in \_ = KeychainHelper.saveBackendToken(token) }

1. User can restart backend server from settings
   - Evidence:
     - Code: SettingsView :: Button("Restart Server") { backendManager.stopServer(); ... backendManager.startServer() }

## Inputs and Outputs

- Inputs: User configuration choices (audio source, model, host/port/token)
- Outputs: Updated app configuration persisted to storage
- Side effects (writes, network calls, model loads, UI state changes): Settings saved to UserDefaults/Keychain, backend restart triggered if requested

## Failure Modes

List 5â€“10 realistic failures:

- Failure: Keychain access fails
  - Where detected: KeychainHelper.saveBackendToken returns false
  - Current handling (as evidenced): Failure is surfaced inline in settings/onboarding UI and recorded via `AppState.recordCredentialSaveFailure(field:)`
  - User-visible outcome (if any): Visible error text near token field + in-app error notice
  - Evidence: MeetingListenerApp.swift :: SettingsView.onChange(of: backendToken); OnboardingView.swift :: onChange(of: hfToken); AppState.swift :: recordCredentialSaveFailure(field:)

- Failure: Backend restart fails
  - Where detected: backendManager.startServer() fails
  - Current handling (as evidenced): Server status updates to error state
  - User-visible outcome (if any): Server status shows error in settings
  - Evidence: BackendManager :: server status updates

## Data and Storage

- What data is produced/consumed: Audio source, whisper model, backend host/port, auth token
- Where it is stored (DB/files/userData/etc.): UserDefaults for non-sensitive settings, Keychain for tokens
- Retention / deletion controls (if documented): UserDefaults persists until app reset, Keychain managed by system

## Observability

- Logs/events emitted: Credential save failures are logged with field metadata
- Correlation IDs / session IDs (if any): None
- Metrics/traces (if any): None
  Evidence: AppState.swift :: StructuredLogger.shared.error(\"Credential save failed\", metadata: [\"field\": ...])

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: When do settings changes take effect? What validation exists?
- Documentation gaps to fill: Settings persistence and validation rules
- Test gaps to add (note only, no implementation): Test settings persistence, test invalid configurations</content>
  <parameter name="filePath">/Users/pranay/Projects/EchoPanel/docs/flows/EXT-009.md

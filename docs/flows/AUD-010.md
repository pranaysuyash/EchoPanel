# AUD-010 Client-Side VAD (Silero)

## Summary

- Origin: Mixed
- Status: Partial
- 1â€“2 sentence description: Filters silent audio segments on the client before transmission to reduce server load and network bandwidth by ~40%.
- Boundaries crossed: UI (VAD processing), OS (audio processing), Network (reduced data transmission)
- Primary components (coarse list): AudioCaptureManager, MicrophoneCaptureManager, Silero VAD model

## Triggers and Preconditions

- Triggers: Audio frame received, VAD enabled in settings, model loaded
- Preconditions: Silero VAD model available on client, sufficient compute resources, VAD enabled flag set

## Sequence (Happy Path)

1. **VAD model initialization**
   - Load Silero VAD model on client startup or first use
   - Cache model in memory for session duration
   - Evidence:
     - Code: server/services/vad_filter.py:22-41 (server-side reference)
     - Docs: docs/audit/audio-pipeline-deep-dive-20260211.md:1029

2. **Audio chunk accumulation**
   - Buffer 2-3 seconds of audio for VAD analysis
   - Convert PCM16 to WAV format for Silero input
   - Evidence:
     - Code: server/services/vad_filter.py:42-54 (server-side reference)
     - Docs: docs/audit/audio-pipeline-deep-dive-20260211.md:1036

3. **Speech probability calculation**
   - Run Silero VAD inference on audio chunk
   - Get speech probability scores per frame
   - Evidence:
     - Code: server/services/vad_filter.py:87-95 (server-side reference)
     - Docs: docs/audit/audio-pipeline-deep-dive-20260211.md:1040

4. **Speech segment extraction**
   - Identify contiguous speech segments above threshold
   - Extract timestamp ranges for speech portions
   - Evidence:
     - Code: server/services/vad_filter.py:100-108 (server-side reference)
     - Docs: docs/audit/audio-pipeline-deep-dive-20260211.md:1050

5. **Audio filtering**
   - Only transmit speech segments to server
   - Drop silent portions to save bandwidth
   - Evidence:
     - Code: Hypothesized - would modify AudioCaptureManager.swift:255
     - Docs: docs/flow-atlas-20260211.md:730

6. **Fallback transmission**
   - If VAD fails, transmit raw audio as fallback
   - Log VAD failure for debugging
   - Evidence:
     - Code: server/services/vad_filter.py:110-112 (server-side reference)
     - Docs: docs/audit/audio-pipeline-deep-dive-20260211.md:1064

## Inputs and Outputs

- Inputs:
  - Raw PCM16 audio frames (16kHz mono)
  - VAD threshold settings (default 0.5)
- Outputs:
  - Filtered audio chunks containing only speech
  - Speech timestamp metadata
- Side effects: Reduced network traffic, lower server ASR load, potential speech clipping if VAD too aggressive

## Failure Modes

- Failure: VAD model load failure
  - Where detected: Model initialization on client
  - Current handling: Hypothesized - no client VAD implemented
  - User-visible outcome: Falls back to transmitting all audio
  - Evidence: server/services/vad_filter.py:22-41

- Failure: VAD inference timeout
  - Where detected: Speech probability calculation exceeds time limit
  - Current handling: Hypothesized - no timeout handling
  - User-visible outcome: Audio transmission delayed or dropped
  - Evidence: docs/audit/audio-pipeline-deep-dive-20260211.md:1059

- Failure: False positive speech detection
  - Where detected: VAD marks noise as speech
  - Current handling: Static threshold (0.5), no adaptation
  - User-visible outcome: Unnecessary audio transmission, wasted bandwidth
  - Evidence: docs/audit/audio-pipeline-deep-dive-20260211.md:1789

- Failure: False negative speech detection
  - Where detected: VAD misses actual speech segments
  - Current handling: No fallback detection of missed speech
  - User-visible outcome: Speech segments dropped, transcript gaps
  - Evidence: docs/audit/audio-pipeline-deep-dive-20260211.md:1770

- Failure: Client compute resource exhaustion
  - Where detected: VAD processing consumes too much CPU/memory
  - Current handling: Hypothesized - no resource monitoring
  - User-visible outcome: App performance degradation, audio capture issues
  - Evidence: docs/flow-atlas-20260211.md:730

## Data and Storage

- What data is produced/consumed: VAD model weights, audio chunks, speech probabilities
- Where it is stored: Client memory (model cached), temporary audio buffers
- Retention / deletion controls: Model persists across sessions, buffers cleared per chunk

## Observability

- Logs/events emitted: VAD load success/failure, speech ratio metrics, filtering efficiency
- Correlation IDs / session IDs: Session ID for tracking VAD performance
- Metrics/traces: Speech detection accuracy, bandwidth savings, processing latency
- Evidence: server/services/vad_filter.py logging (server-side reference)

## Open Questions and Follow-up Tasks

- Questions: What VAD threshold optimizes speech detection vs bandwidth? How to handle VAD model updates?
- Documentation gaps: Client-side Silero integration, performance impact analysis
- Test gaps: VAD accuracy testing, bandwidth savings measurement, fallback behavior validation

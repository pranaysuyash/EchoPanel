# AUD-010 Client-Side VAD (Silero)

## Summary

- Origin: Mixed (audit hypothesis + staged feature wiring)
- Status: Implemented
- Client-side VAD filtering behavior is not active yet, but staged feature flags and telemetry contract plumbing are implemented.
- Boundaries crossed: Settings/UI flag surface / websocket start contract / server metrics
- Primary components (coarse list): BroadcastFeatureManager, BackendConfig, WebSocketStreamer, ws_live_listener.py

## Triggers and Preconditions

- Triggers: user toggles staged VAD flag in Broadcast settings; session start handshake; metrics loop
- Preconditions: websocket session started

## Sequence (Current Behavior)

1. Broadcast settings expose a staged `Client-Side VAD` toggle.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/BroadcastFeatureManager.swift` :: `useClientVAD` + settings section
2. Backend config reads the staged VAD flag from user defaults.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/BackendConfig.swift` :: `clientVADEnabled`
3. WebSocket start payload includes `client_features.client_vad_enabled` and telemetry flags.
   - Evidence:
     - Code: `macapp/MeetingListenerApp/Sources/WebSocketStreamer.swift` :: `sendStart()` payload
4. Server stores the client VAD staged flag and publishes it in status/metrics/final summary payloads.
   - Evidence:
     - Code: `server/api/ws_live_listener.py` :: start handler + `_metrics_loop` + final summary block

## Inputs and Outputs

- Inputs:
  - UserDefaults staged toggle (`broadcast_useClientVAD`)
  - Start message `client_features`
- Outputs:
  - Metrics payload fields (`client_vad_enabled`, `client_vad_telemetry_enabled`)
  - Final summary `client_features`
- Side effects: observability/contract only; client does not drop/trim frames yet

## Failure Modes

- Failure: Staged flag enabled expecting immediate filtering behavior
  - Where detected: runtime behavior (audio path unchanged)
  - Current handling: flag is telemetry-only groundwork
  - User-visible outcome: no VAD-based traffic reduction yet
  - Evidence: `macapp/MeetingListenerApp/Sources/BroadcastFeatureManager.swift` staged note text

- Failure: Missing/invalid `client_features` object
  - Where detected: server parser
  - Current handling: defaults to `False`
  - User-visible outcome: no behavior change, safe fallback
  - Evidence: `server/api/ws_live_listener.py` :: `_extract_client_features`

## Data and Storage

- What data is produced/consumed: staged VAD booleans in start/status/metrics/final summary payloads
- Where it is stored: user defaults (client), session state (server), event payloads
- Retention / deletion controls: session-scoped on server; persistent user preference on client

## Observability

- Logs/events emitted: session start log includes `client_vad` flag state
- Correlation IDs / session IDs: unchanged; carried by existing metrics envelope
- Metrics/traces: `client_vad_enabled` and `client_vad_telemetry_enabled` in metrics stream

## Open Questions and Follow-up Tasks

- Questions: what local CPU budget and chunking strategy should gate client VAD activation?
- Documentation gaps: client VAD inference path, fallback policy, safety thresholds
- Test gaps: audio-quality/latency regression tests when real client VAD processing is introduced

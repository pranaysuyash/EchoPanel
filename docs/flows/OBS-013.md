# OBS-013 Error Classification & User Surfacing Flow

## Summary
- Origin: Code-only
- Status: Implemented
- Classifies runtime errors into specific categories (permission, capture, backend, streaming) and surfaces user-friendly error messages in the UI.
- Boundaries crossed: UI (status updates) / Process (error state management)
- Primary components (coarse list): AppRuntimeErrorState enum, setSessionError function, statusMessage

## Triggers and Preconditions
- Triggers: Exceptions caught during session operations (capture start, backend connection, streaming)
- Preconditions: Session in active state, error not already set

## Sequence (Happy Path)
Use numbered sequence. Each step must include evidence.
For each step:
1. <what happens>
   - Evidence:
     - Code: path :: symbol/event/string
     - Docs: path :: heading/snippet
   - Notes: (only if needed)

1. Exception thrown during operation (capture start, etc.)
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: } catch { setSessionError(.systemCaptureFailed(detail: error.localizedDescription)) }
     - Docs: docs/flow-atlas-20260211.md :: Error classification basic

2. Error categorized into AppRuntimeErrorState enum
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: enum AppRuntimeErrorState: Equatable
     - Docs: docs/flow-atlas-20260211.md :: OBS-013 Error Classification & User Surfacing Flow

3. setSessionError called with specific error type
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: private func setSessionError(_ error: AppRuntimeErrorState)
     - Docs: Assumed from error handling patterns

4. Session state set to .error
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: sessionState = .error

5. Runtime error state stored for UI display
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: runtimeErrorState = error

6. User-friendly message extracted from error.message
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: var message: String { switch self { ... } }
     - Docs: docs/flow-atlas-20260211.md :: Generic exception handling, no error taxonomy

7. Status message updated in UI
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/AppState.swift :: statusMessage = error.message

## Inputs and Outputs
- Inputs: Caught exception with localizedDescription
- Outputs: Updated sessionState, runtimeErrorState, statusMessage
- Side effects (writes, network calls, model loads, UI state changes): UI status display updated, session operations halted

## Failure Modes
List 5â€“10 realistic failures:
- Failure: Error message generation fails
  - Where detected: error.message property
  - Current handling: Fallback to generic messages
  - User-visible outcome: Less specific error messages
  - Evidence: Assumed from switch statement structure

- Failure: UI update fails
  - Where detected: statusMessage assignment
  - Current handling: Silent failure
  - User-visible outcome: UI not updated with error
  - Evidence: Assumed from property assignment

- Failure: Multiple errors overwrite each other
  - Where detected: setSessionError called multiple times
  - Current handling: Last error wins
  - User-visible outcome: Only most recent error shown
  - Evidence: macapp/MeetingListenerApp/Sources/AppState.swift :: runtimeErrorState = error (assignment)

- Failure: Error state not reset on retry
  - Where detected: resetSession not called
  - Current handling: Error persists until manual reset
  - User-visible outcome: Stale error messages
  - Evidence: Assumed from state management

- Failure: Error detail too verbose
  - Where detected: error.localizedDescription
  - Current handling: Directly used in messages
  - User-visible outcome: Technical error messages shown to users
  - Evidence: macapp/MeetingListenerApp/Sources/AppState.swift :: setSessionError(.systemCaptureFailed(detail: error.localizedDescription))

## Data and Storage
- What data is produced/consumed: Error details, error type, user message
- Where it is stored (DB/files/userData/etc.): In-memory AppState properties
- Retention / deletion controls (if documented): Cleared on session reset

## Observability
- Logs/events emitted: None specific to classification, underlying errors may be logged
- Correlation IDs / session IDs (if any): None
- Metrics/traces (if any): Error type counts
Evidence: Assumed from error handling patterns

## Open Questions and Follow-up Tasks
- Questions that cannot be answered from current evidence: Are errors logged? What recovery actions are suggested?
- Documentation gaps to fill: Error taxonomy details, recovery guidance
- Test gaps to add (note only, no implementation): Test error message generation, UI update behavior, error state transitions
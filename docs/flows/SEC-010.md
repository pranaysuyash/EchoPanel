# SEC-010 Log Redaction (PII Protection)

## Summary

- Origin: Code-only
- Status: Implemented
- Automatic redaction of sensitive data (API tokens, file paths with usernames, bearer tokens) from structured logs to prevent PII leakage while maintaining debugging capability.
- Boundaries crossed: Process / Storage
- Primary components (coarse list): Swift StructuredLogger, regex patterns

## Triggers and Preconditions

- Triggers: Any structured log event emitted
- Preconditions: StructuredLogger initialized with default redaction patterns

## Sequence (Happy Path)

1. Log event created with message and metadata
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: log(level:message:metadata:) (line 280)
2. Redact function called on message text
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: redact(message) (line 288)
3. Redact function applies each regex pattern from defaults
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: for pattern in configuration.redactionPatterns (line 335)
4. NSRegularExpression replaces matching sensitive data with placeholders
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: regex.stringByReplacingMatches (lines 337-342)
5. Metadata values also redacted if they contain strings
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: redactedMetadata (lines 310-316)
6. Redacted log entry written to system log
   - Evidence:
     - Code: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: writeToOSLog (line 349)

## Inputs and Outputs

- Inputs: Raw log message and metadata strings
- Outputs: Redacted log entries written to system log
- Side effects (writes, network calls, model loads, UI state changes): System log writes with sanitized content

## Failure Modes

- Failure: Regex pattern compilation fails
  - Where detected: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: redact
  - Current handling (as evidenced): Pattern skipped, processing continues with other patterns
  - User-visible outcome (if any): Some sensitive data may not be redacted
  - Evidence: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: try? NSRegularExpression (line 336)
- Failure: Redaction patterns not comprehensive
  - Where detected: Pattern matching during redact
  - Current handling (as evidenced): Unmatched sensitive data passes through
  - User-visible outcome (if any): Potential PII leakage in logs
  - Evidence: Limited to predefined patterns in RedactionPattern.defaults
- Failure: Metadata redaction misses complex objects
  - Where detected: macapp/MeetingListenerApp/Sources/StructuredLogger.swift :: redactedMetadata
  - Current handling (as evidenced): Only string values redacted, other types pass through
  - User-visible outcome (if any): Non-string metadata may contain sensitive data
  - Evidence: Only applies redact() to string values

## Data and Storage

- What data is produced/consumed: Log messages with potential PII (tokens, paths, usernames)
- Where it is stored (DB/files/userData/etc.): macOS system log (Console.app)
- Retention / deletion controls (if documented): Follows system log rotation policies

## Observability

- Logs/events emitted: Redacted log entries (circular)
- Correlation IDs / session IDs (if any): Preserved in redacted logs
- Metrics/traces (if any): None
  Evidence: Redaction is part of the logging process itself

## Open Questions and Follow-up Tasks

- Questions: Are the regex patterns comprehensive enough for all sensitive data types?
- Documentation gaps: No explicit documentation of what gets redacted
- Test gaps: Unit tests for redaction pattern effectiveness
- Follow-up: Consider server-side log redaction if needed

# MOD-007 5-Level Degrade Ladder (NORMAL → WARNING → DEGRADE → EMERGENCY → FAILOVER)

## Summary

- Origin: Code-only
- Status: Implemented
- Adaptive performance management system that monitors Real-Time Factor (RTF) and applies progressive degradation strategies to maintain responsiveness under load, from chunk size increases to provider failover.
- Boundaries crossed: Model / Pipeline / UI
- Primary components (coarse list): DegradeLadder class, RTF monitoring, action execution, provider switching

## Triggers and Preconditions

- Triggers (user action, event, schedule, startup, etc.): RTF measurement during inference, provider errors
- Preconditions (permissions, settings flags, availability, model cached, etc.): DegradeLadder initialized with provider and config, RTF history available

## Sequence (Happy Path)

1. Initialize degrade ladder with provider, config, thresholds, and callback
   - Evidence:
     - Code: server/services/degrade_ladder.py:119-148
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1174-1188
2. Build action map for level transitions (NORMAL->WARNING: increase chunk, WARNING->DEGRADE: reduce quality, DEGRADE->EMERGENCY: drop chunks, any->FAILOVER: switch provider)
   - Evidence:
     - Code: server/services/degrade_ladder.py:150-188
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1190-1220
3. Check RTF and determine if level change needed, record RTF in history
   - Evidence:
     - Code: server/services/degrade_ladder.py:190-228
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1222-1256
4. Convert RTF to target degrade level based on thresholds
   - Evidence:
     - Code: server/services/degrade_ladder.py:230-239
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1258-1267
5. Execute degrade action if degrading, update state and apply action
   - Evidence:
     - Code: server/services/degrade_ladder.py:241-272
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1269-1304
6. Check for recovery if RTF improved, step up one level at a time
   - Evidence:
     - Code: server/services/degrade_ladder.py:274-326
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1306-1358
7. Apply specific actions: increase chunk size, reduce quality (downgrade model, disable VAD), enable chunk dropping, or failover to backup provider
   - Evidence:
     - Code: server/services/degrade_ladder.py:348-407
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1360-1420
8. Check if chunk should be dropped in emergency mode
   - Evidence:
     - Code: server/services/degrade_ladder.py:328-335
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1422-1429
9. Report provider errors and trigger failover if available
   - Evidence:
     - Code: server/services/degrade_ladder.py:337-344
     - Docs: docs/audit/asr-model-lifecycle-20260211.md:1431-1438

## Inputs and Outputs

- Inputs: RTF measurements, provider errors, configuration thresholds
- Outputs: Current degrade level, applied actions, modified config (chunk size, model, VAD enabled)
- Side effects (writes, network calls, model loads, UI state changes): Model switching, config changes, chunk dropping, status messages to client

## Failure Modes

- Failure: RTF spikes but minimum time at level not met
  - Where detected: Time check in check()
  - Current handling (as evidenced): Delay degradation
  - User-visible outcome (if any): Debug log
  - Evidence: degrade_ladder.py:203-207
- Failure: No action defined for transition
  - Where detected: Action lookup
  - Current handling (as evidenced): Log warning, continue
  - User-visible outcome (if any): Warning log
  - Evidence: degrade_ladder.py:254-256
- Failure: Model downgrade not available
  - Where detected: Model mapping
  - Current handling (as evidenced): Keep current model
  - User-visible outcome (if any): No model change
  - Evidence: degrade_ladder.py:362-383
- Failure: No fallback provider for failover
  - Where detected: Failover action
  - Current handling (as evidenced): Log error
  - User-visible outcome (if any): Error log
  - Evidence: degrade_ladder.py:401-407
- Failure: Recovery check too frequent
  - Where detected: Recovery window check
  - Current handling (as evidenced): Skip recovery
  - User-visible outcome (if any): None
  - Evidence: degrade_ladder.py:277-280

## Data and Storage

- What data is produced/consumed: RTF history, degrade state, applied actions
- Where it is stored (DB/files/userData/etc.): In-memory state
- Retention / deletion controls (if documented): History pruned after HISTORY_WINDOW_S

## Observability

- Logs/events emitted: Degrade/recover messages, action descriptions, RTF averages
- Correlation IDs / session IDs (if any): None specific
- Metrics/traces (if any): Degrade level in metrics
- Evidence: degrade_ladder.py logs, docs/DEPLOYMENT_GUIDE.md:212

## Open Questions and Follow-up Tasks

- Questions that cannot be answered from current evidence: Is degrade ladder fully integrated into main ASR loop?
- Documentation gaps: Integration status, recovery thresholds
- Test gaps to add (note only, no implementation): Test level transitions, action reversals, RTF history pruning

